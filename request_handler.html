<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Over View - MinorWork Framework</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="main.css">
<link rel="stylesheet" href="prism-okaidia.css">
<link rel="icon" type="image/png" href="favicon.png"/>
</head>
<body>
<header>
<div class="wrapper">
<a id="logoLink" href="https://cqd.github.io/minorwork/"><img src="logo.svg" height="33"></a>
<nav><a href="https://github.com/CQD/minorwork/blob/master/README.md">Document</a> <a href="https://github.com/CQD/minorwork">Github</a></nav>
</div>
</header>

<article class="wrapper">
<h1>Request handler</h1>
<p>A request handler can be either:</p>
<ul>
<li>A controller/method pair string (recommended).
<ul>
<li><code>'\Controller\User:login'</code> means <code>$obj = new \Controller\User(); $obj-&gt;login($app, $params)</code></li>
</ul></li>
<li>A PHP <a href="http://php.net/manual/en/language.types.callable.php">callable</a>, like name of a function, or a closure, or other callable type.
<ul>
<li><code>'loginHandler'</code> means calling <code>loginHandler($app, $params)</code></li>
</ul></li>
</ul>
<p>When called, request handler will be given three inputs:</p>
<ul>
<li>The container itself.</li>
<li>URL parameter matched in router
<ul>
<li>For url pattern <code>/user/{id:\d+}[/{name}]</code>, <code>$params</code> for <code>/user/42</code> would be <code>['id' =&gt; 42]</code></li>
<li>Return value of previous request handler, or null if there is no previous handler.</li>
</ul></li>
</ul>
<p>A simple request handler looks likes this:</p>
<pre><code class="language-php">function basicHandler($app, $params, $prev) {
    $app-&gt;view-&gt;prepare([
        'params' =&gt; $params,
        '$prev' =&gt; $prev,
    ]);
}</code></pre>
<h3>Handler Queue and Middleware</h3>
<p>For each request there can be multiple request handler. MinorWork maintains a handler queue internally, handler queue can be altered at the runtime:</p>
<ul>
<li><code>$app-&gt;stop()</code> clears handler queue.</li>
<li><code>$app-&gt;appendHandlerQueue()</code> add a request handler (or an array of handlers) to the end of handler queue</li>
<li><code>$app-&gt;preppendHandlerQueue()</code> add a request handler (or an array of handlers) to the beginning of handler queue</li>
</ul>
<p>Setting multiple request handlers to a route is MinorWork's way to do middleware. You can reuse handler in many routes.</p>
<p>For example, you may want to make a auth handler that check if user has logged in, if and redirect to login page using <code>$app-&gt;redirectTo('login')</code> when need.</p>
<pre><code class="language-php">$route = [
    'article' =&gt; ['/a/{id}',      ['checkAuth', '\Article:show']],
    'msg'     =&gt; ['/my/messages', ['checkAuth', '\Profile:showMessage']],
    'login'   =&gt; ['/login',       '\Login:login'],
];</code></pre>
<h3>Handler Alias and Class Prefix</h3>
<p>You can use <code>$app-&gt;handlerAlias()</code> to set alias name for a handler. For example:</p>
<pre><code class="language-php">$app-&gt;handlerAlias([
    'CheckLogin' =&gt; '\Handler\Validation:checkLogin',
    'logArticleView' =&gt; function($app, $param, $prev){
        // do some logging here
    },
]);

$app-&gt;setRouting([
    'article' =&gt; ['/a/{id}',      ['checkAuth', '\Article:show', 'logPageView']],
    'msg'     =&gt; ['/my/messages', ['checkAuth', '\Profile:showMessage']],
    'login'   =&gt; ['/login',       '\Login:login'],
]);</code></pre>
</article>

<footer>
<div class="wrapper"><p>Made with ‚ù§ by <a href="https://github.com/cqd">CQD</a>, 2017<br>MIT License</p></div>
</footer>

<script src="prism.js"></script>
<script src="prism-php.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-368263-21', 'auto');
  ga('send', 'pageview', '\x2Fcontainer');
</script>
</body>
</html>
